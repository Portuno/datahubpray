# Script para configurar permisos de BigQuery
# Este script te ayudar√° a configurar los permisos necesarios para la cuenta de servicio

echo "üîß Configuraci√≥n de permisos de BigQuery"
echo "========================================"
echo ""
echo "‚ùå Error detectado:"
echo "   User does not have bigquery.jobs.create permission"
echo ""
echo "üìã Pasos para solucionarlo:"
echo ""
echo "1Ô∏è‚É£ Ir a Google Cloud Console:"
echo "   https://console.cloud.google.com/iam-admin/iam?project=dataton25-prayfordata"
echo ""
echo "2Ô∏è‚É£ Buscar la cuenta de servicio:"
echo "   balearia-backend-service@dataton25-prayfordata.iam.gserviceaccount.com"
echo ""
echo "3Ô∏è‚É£ Hacer clic en el bot√≥n de permisos (√≠cono de l√°piz)"
echo ""
echo "4Ô∏è‚É£ Agregar los siguientes roles:"
echo "   ‚úÖ BigQuery Data Viewer"
echo "   ‚úÖ BigQuery Job User"
echo "   ‚úÖ BigQuery User"
echo ""
echo "5Ô∏è‚É£ Guardar los cambios"
echo ""
echo "üîÑ Alternativamente, ejecutar estos comandos gcloud:"
echo ""
echo "# Dar permisos de BigQuery Data Viewer"
echo "gcloud projects add-iam-policy-binding dataton25-prayfordata \\"
echo "    --member=\"serviceAccount:balearia-backend-service@dataton25-prayfordata.iam.gserviceaccount.com\" \\"
echo "    --role=\"roles/bigquery.dataViewer\""
echo ""
echo "# Dar permisos de BigQuery Job User"
echo "gcloud projects add-iam-policy-binding dataton25-prayfordata \\"
echo "    --member=\"serviceAccount:balearia-backend-service@dataton25-prayfordata.iam.gserviceaccount.com\" \\"
echo "    --role=\"roles/bigquery.jobUser\""
echo ""
echo "# Dar permisos de BigQuery User"
echo "gcloud projects add-iam-policy-binding dataton25-prayfordata \\"
echo "    --member=\"serviceAccount:balearia-backend-service@dataton25-prayfordata.iam.gserviceaccount.com\" \\"
echo "    --role=\"roles/bigquery.user\""
echo ""
echo "üìù Nota: Necesitas tener permisos de administrador en el proyecto para ejecutar estos comandos"
echo ""
echo "üß™ Despu√©s de configurar los permisos, ejecutar:"
echo "   ./test-gcd-bigquery.sh"
echo ""
echo "‚úÖ Una vez configurado, ver√°s datos reales de BigQuery en lugar de datos mock"
